# Test Configuration for AMI Dataset Training
# =============================================================================

# Model Configuration
model:
  model_type: encoder
  name: ami_diarization_model
  
  global_config:
    dropout: 0.1
    batch_size: 4
    d_ff: 4
    device: cpu
  
  encoder:
    d_model: 256
    num_layers: 2
    num_heads: 4
    attention_type: linear
    activation: GELU
    nb_features: 128

# Dataset Configuration
global_config:
  corpus_dir: ./data
  output_dir: ./manifests
  force_download: false
  
  # Feature extraction configuration (unified for all datasets)
  feature_type: fbank  # Options: fbank, mfcc, spectrogram
  num_mel_bins: 80  # Number of mel-frequency bins
  frame_length: 0.025  # Frame length in seconds (25ms)
  frame_shift: 0.01  # Frame shift in seconds (10ms)
  sampling_rate: 16000  # Target sampling rate
  dither: 0.0  # Dithering factor
  snip_edges: false  # Whether to snip edges

datasets:
  - name: ami

# Training Configuration
training:
  # Basic settings
  epochs: 2
  batch_size: 4
  random_seed: 42
  max_steps: 10  # Small number for testing
  
  # Optimizer
  optimizer:
    type: adam
    lr: 0.0001
    weight_decay: 0.01
    betas: [0.9, 0.999]
  
  # Scheduler
  scheduler:
    type: constant
    min_lr: 0.000001
    warmup_steps: 5
  
  # Training behavior
  gradient_clipping: 1.0
  gradient_accumulation_steps: 1
  mixed_precision: false
  
  # Performer-specific (not needed but included for completeness)
  feature_redraw_interval: null
  fixed_projection: false
  
  # Loss configuration
  loss:
    main: cross_entropy
    label_smoothing: null
    reduction: mean
  
  # Validation
  validation:
    interval: 5
    batch_size: 4
  
  # Checkpointing
  checkpoint:
    save_dir: ./test_checkpoints/ami
    interval: 5
    save_total_limit: 2
    resume: null
    snapshot_optimizer: true
    snapshot_scheduler: true
    snapshot_features: true
  
  # Logging (via Accelerate)
  logging:
    interval: 2
    tensorboard: false
    wandb: false
    log_metrics: [loss, accuracy]
    log_model: false
  
  # Performance
  performance:
    num_workers: 0
    pin_memory: false
  
  # Diarization settings
  eval_knobs:
    label_type: binary  # binary speaker activity
    max_duration: null

